<!DOCTYPE html>
<!-- saved from url=(0046)https://www.wjceo.com/examples/threejs/90.html -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Title</title>
  </head>

  <body onload="draw();">
    <script src="./03/three.min.js"></script>
    <script src="./03/inflate.min.js"></script>
    <script src="./03/FBXLoader.js"></script>
    <script src="./03/OrbitControls.js"></script>
    <script src="./03/stats.min.js"></script>
    <script src="./03/dat.gui.min.js"></script>
    <script src="./03/Detector.js"></script>

    <script>
      var renderer, camera, scene, gui, light, stats, controls, meshHelper, mixer, action, datGui;
      var clock = new THREE.Clock();

      function initRender() {
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0xeeeeee);
        renderer.shadowMap.enabled = true;
        //å‘Šè¯‰æ¸²æŸ“å™¨éœ€è¦é˜´å½±æ•ˆæœ
        document.body.appendChild(renderer.domElement);
      }

      function initCamera() {
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
        camera.position.set(100, 200, 300);
      }

      function initScene() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xa0a0a0);
        scene.fog = new THREE.Fog(0xa0a0a0, 200, 1000);
      }

      //åˆå§‹åŒ–dat.GUIç®€åŒ–è¯•éªŒæµç¨‹
      function initGui() {
        //å£°æ˜ä¸€ä¸ªä¿å­˜éœ€æ±‚ä¿®æ”¹çš„ç›¸å…³æ•°æ®çš„å¯¹è±¡
        gui = {
          helper: true, //æ¨¡å‹è¾…åŠ©çº¿
        };
        datGui = new dat.GUI();
        //å°†è®¾ç½®å±æ€§æ·»åŠ åˆ°guiå½“ä¸­ï¼Œgui.add(å¯¹è±¡ï¼Œå±æ€§ï¼Œæœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼‰

        datGui.add(gui, 'helper').onChange(function (e) {
          meshHelper.visible = e;
        });
      }

      function initLight() {
        scene.add(new THREE.AmbientLight(0x444444));

        light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0, 200, 100);

        light.castShadow = true;
        light.shadow.camera.top = 180;
        light.shadow.camera.bottom = -100;
        light.shadow.camera.left = -120;
        light.shadow.camera.right = 120;

        //å‘Šè¯‰å¹³è¡Œå…‰éœ€è¦å¼€å¯é˜´å½±æŠ•å°„
        light.castShadow = true;

        scene.add(light);
      }

      function initModel() {
        //è¾…åŠ©å·¥å…·
        var helper = new THREE.AxesHelper(50);
        scene.add(helper);

        // åœ°æ¿
        var mesh = new THREE.Mesh(
          new THREE.PlaneBufferGeometry(2000, 2000),
          new THREE.MeshPhongMaterial({ color: 0xffffff, depthWrite: false }),
        );
        mesh.rotation.x = -Math.PI / 2;
        mesh.receiveShadow = true;
        scene.add(mesh);

        //æ·»åŠ åœ°æ¿å‰²çº¿
        var grid = new THREE.GridHelper(2000, 20, 0x000000, 0x000000);
        grid.material.opacity = 0.2;
        grid.material.transparent = true;
        scene.add(grid);

        //åŠ è½½æ¨¡å‹
        var loader = new THREE.FBXLoader();
        // const model = "/src/assets/threejs/models/fbx/Naruto.fbx";
        // const model = "/src/assets/threejs/models/fbx/Samba Dancing.fbx";
        const model = '/src/assets/threejs/models/fbx/bulu.fbx';
        // const model = '/src/assets/threejs/models/fbx/ds.fbx';
        // const model = "/src/assets/threejs/models/fbx/shaoqing.fbx";
        // const model = '/src/assets/threejs/models/fbx/spaceman.fbx';
        loader.load(model, function (mesh) {
          console.log(`ğŸš€ ~ mesh`, mesh);

          //æ·»åŠ éª¨éª¼è¾…åŠ©
          meshHelper = new THREE.SkeletonHelper(mesh);
          scene.add(meshHelper);

          //è®¾ç½®æ¨¡å‹çš„æ¯ä¸ªéƒ¨ä½éƒ½å¯ä»¥æŠ•å½±
          mesh.traverse(function (child) {
            if (child.isMesh) {
              child.castShadow = true;
              child.receiveShadow = true;
            }
          });

          //AnimationMixeræ˜¯åœºæ™¯ä¸­ç‰¹å®šå¯¹è±¡çš„åŠ¨ç”»æ’­æ”¾å™¨ã€‚å½“åœºæ™¯ä¸­çš„å¤šä¸ªå¯¹è±¡ç‹¬ç«‹åŠ¨ç”»æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå¯¹è±¡ä½¿ç”¨ä¸€ä¸ªAnimationMixer
          mixer = mesh.mixer = new THREE.AnimationMixer(mesh);

          //mixer.clipAction è¿”å›ä¸€ä¸ªå¯ä»¥æ§åˆ¶åŠ¨ç”»çš„AnimationActionå¯¹è±¡  å‚æ•°éœ€è¦ä¸€ä¸ªAnimationClip å¯¹è±¡
          //AnimationAction.setDuration è®¾ç½®ä¸€ä¸ªå¾ªç¯æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå½“å‰è®¾ç½®äº†ä¸€ç§’
          //å‘Šè¯‰AnimationActionå¯åŠ¨è¯¥åŠ¨ä½œ
          //action = mixer.clipAction(mesh.animations[0]);
          //action.play();

          var actions = []; //æ‰€æœ‰çš„åŠ¨ç”»æ•°ç»„
          var animations = datGui.addFolder('animations');

          for (var i = 0; i < mesh.animations.length; i++) {
            createAction(i);
          }

          function createAction(i) {
            actions[i] = mixer.clipAction(mesh.animations[i]);
            gui['action' + i] = function () {
              for (var j = 0; j < actions.length; j++) {
                if (j === i) {
                  actions[j].play();
                } else {
                  actions[j].stop();
                }
              }
            };

            animations.add(gui, 'action' + i);
          }

          //æ·»åŠ æš‚åœæ‰€æœ‰åŠ¨ç”»çš„æŒ‰é”®
          gui.stop = function () {
            for (var i = 0; i < actions.length; i++) {
              actions[i].stop();
            }
          };

          datGui.add(gui, 'stop');

          mesh.position.y += 100;

          scene.add(mesh);
        });
      }

      //åˆå§‹åŒ–æ€§èƒ½æ’ä»¶
      function initStats() {
        stats = new Stats();
        document.body.appendChild(stats.dom);
      }

      function initControls() {
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        //è®¾ç½®æ§åˆ¶å™¨çš„ä¸­å¿ƒç‚¹
        //controls.target.set( 0, 100, 0 );
        // å¦‚æœä½¿ç”¨animateæ–¹æ³•æ—¶ï¼Œå°†æ­¤å‡½æ•°åˆ é™¤
        //controls.addEventListener( 'change', render );
        // ä½¿åŠ¨ç”»å¾ªç¯ä½¿ç”¨æ—¶é˜»å°¼æˆ–è‡ªè½¬ æ„æ€æ˜¯å¦æœ‰æƒ¯æ€§
        controls.enableDamping = true;
        //åŠ¨æ€é˜»å°¼ç³»æ•° å°±æ˜¯é¼ æ ‡æ‹–æ‹½æ—‹è½¬çµæ•åº¦
        //controls.dampingFactor = 0.25;
        //æ˜¯å¦å¯ä»¥ç¼©æ”¾
        controls.enableZoom = true;
        //æ˜¯å¦è‡ªåŠ¨æ—‹è½¬
        controls.autoRotate = false;
        controls.autoRotateSpeed = 0.5;
        //è®¾ç½®ç›¸æœºè·ç¦»åŸç‚¹çš„æœ€è¿œè·ç¦»
        controls.minDistance = 1;
        //è®¾ç½®ç›¸æœºè·ç¦»åŸç‚¹çš„æœ€è¿œè·ç¦»
        controls.maxDistance = 2000;
        //æ˜¯å¦å¼€å¯å³é”®æ‹–æ‹½
        controls.enablePan = true;
      }

      function render() {
        var time = clock.getDelta();
        if (mixer) {
          mixer.update(time);
        }

        controls.update();
      }

      //çª—å£å˜åŠ¨è§¦å‘çš„å‡½æ•°
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        //æ›´æ–°æ§åˆ¶å™¨
        render();

        //æ›´æ–°æ€§èƒ½æ’ä»¶
        stats.update();

        renderer.render(scene, camera);

        requestAnimationFrame(animate);
      }

      function draw() {
        //å…¼å®¹æ€§åˆ¤æ–­
        if (!Detector.webgl) Detector.addGetWebGLMessage();

        initGui();
        initRender();
        initScene();
        initCamera();
        initLight();
        initModel();
        initControls();
        initStats();

        animate();
        window.onresize = onWindowResize;
      }
    </script>
    <div class="dg ac">
      <div class="dg main a" style="width: 245px">
        <div
          style="width: 6px; margin-left: -3px; height: 84px; cursor: ew-resize; position: absolute"
        ></div>
        <ul style="height: auto">
          <li class="cr boolean">
            <div>
              <span class="property-name">helper</span>
              <div class="c"><input type="checkbox" checked="checked" /></div>
            </div>
          </li>
          <li class="folder">
            <div class="dg">
              <ul class="closed">
                <li class="title">animations</li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action0</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action1</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action2</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action3</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action4</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action5</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action6</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action7</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action8</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action9</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action10</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action11</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action12</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action13</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action14</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action15</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action16</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action17</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action18</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action19</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action20</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action21</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action22</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action23</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action24</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action25</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
                <li class="cr function">
                  <div>
                    <span class="property-name">action26</span>
                    <div class="c"><div class="button"></div></div>
                  </div>
                </li>
              </ul>
            </div>
          </li>
          <li class="cr function">
            <div>
              <span class="property-name">stop</span>
              <div class="c"><div class="button"></div></div>
            </div>
          </li>
        </ul>
        <div class="close-button close-bottom" style="width: 245px"> Close Controls </div>
      </div>
    </div>
    <!-- <canvas
			width="1920"
			height="979"
			style="width: 1920px; height: 979px"
		></canvas> -->
    <div
      style="position: fixed; top: 0px; left: 0px; cursor: pointer; opacity: 0.9; z-index: 10000"
    >
      <canvas width="80" height="48" style="width: 80px; height: 48px; display: block"></canvas
      ><canvas width="80" height="48" style="width: 80px; height: 48px; display: none"></canvas
      ><canvas width="80" height="48" style="width: 80px; height: 48px; display: none"></canvas>
    </div>
  </body>
</html>
